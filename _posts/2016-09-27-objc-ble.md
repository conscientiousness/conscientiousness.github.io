---
layout:     post
title:      "Core Bluetooth學習筆記"
subtitle:   "Practical CoreBluetooth for Peripherals"
date:       2016-09-22
author:     "Jesse"
header-img: "img/in-post/2016-09-22-ios10-stickers/header-image.jpg"
catalog:    true
tags:
    - iOS
    - BLE
    - Objc
    - Swift
---

最近有空來複習一下Core Bluetooth, 順便也來試試Swift3
1. Objective-C
2. Swift 3.0
3. Xcode 8

### 基本觀念

#### 1. 什麼是BLE - Bluetooth low energy?

> It’s sort of like Bluetooth. We all know Bluetooth, we all use it in speakers and so on, but the difference is this is a very low powered protocol. Typically, one battery can last a month or even years depending on how it is used. That allows us to do things we normally couldn’t do with Bluetooth. The standard is called Bluetooth 4.0, it started with something called “Smart Bluetooth” and evolved to this one, there’s a 200 page manual you can read before you go to sleep, it’s a gripping read. BLE is very cheap in terms of power use and the protocol is not too complex

#### 2. 架構

###### <2.1 App透過Core Bluetooth去控制BLE底層>

<img src="https://developer.apple.com/library/content/documentation/NetworkingInternetWeb/Conceptual/CoreBluetooth_concepts/Art/CBTechnologyFramework_2x.png" style="width: 250px;"/>

###### <2.2 周邊與裝置傳輸對應示意圖>

<img src="https://developer.apple.com/library/content/documentation/NetworkingInternetWeb/Conceptual/CoreBluetooth_concepts/Art/CBDevices1_2x.png" style="width: 550px;"/>

###### <2.3 Peripherals Advertising>

1. Peripherals broadcast some of the data they have in the form of advertising packets. An advertising packet is a relatively small bundle of data that may contain useful information about what a peripheral has to offer.
2. A central can ask to connect to any peripheral that it has discovered advertising.

<img src="https://developer.apple.com/library/content/documentation/NetworkingInternetWeb/Conceptual/CoreBluetooth_concepts/Art/AdvertisingAndDiscovery_2x.png" style="width: 500px;"/>

###### <2.4 Peripheral>

Each peripheral has services, it can have as many services as you want, and each one of these services has characteristics.

<img src="/img/in-post/2016-09-27-ios-corebluetooth/peripheral-structure.png" style="width: 300px;"/>

###### <2.5 Peripheral - Server>

In general you have a service, then this service holds many characteristics, and each characteristic holds a type, value, properties and so on. You don’t have to know the entire thing to work with CoreBluetooth, the most important thing is the reading, this is what we’re actually trying to get and manipulate and change, whatever you need to do, we want this reading and we want to know what we can do with it.

<img src="/img/in-post/2016-09-27-ios-corebluetooth/peripheral-structure-detail.png" style="width: 450px;"/>

###### <2.5 Background>

1. 可被BLE硬體喚醒
2. 可於App在背景時繼續掃描, 資料傳輸
3. Apple對於背景執行的省電有額外的規範要求
4. Background Mode Setting

> Uses Bluetooth LE accessories - Central Mode

> Acts as a Bluetooth LE accessories - Peripheral Mode

<img src="/img/in-post/2016-09-27-ios-corebluetooth/background-mode-setting.png" style="width: 450px;"/>

### Build a Bluetooth Chat App

> **目標:**
> 1. Peripheral Mode: 成為Chat Room Server, 提供其他裝置連入聊天.
> 2. Central Mode: 掃描Peripheral並尋找提供聊天室功能的Peripheral, 連入聊天.

#### 1. Central


### Reference

- [Realm News - corebluetooth](https://realm.io/news/yoav-schwartz-corebluetooth-peripherals/)
- [Apple Core Bluetooth Programming Guide](https://developer.apple.com/library/content/documentation/NetworkingInternetWeb/Conceptual/CoreBluetooth_concepts/CoreBluetoothOverview/CoreBluetoothOverview.html#//apple_ref/doc/uid/TP40013257-CH2-SW1)




